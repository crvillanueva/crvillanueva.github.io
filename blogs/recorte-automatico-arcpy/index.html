<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 3.4.1"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><title data-react-helmet="true"></title><link as="script" rel="preload" href="/webpack-runtime-6954d3e3ead096298f99.js"/><link as="script" rel="preload" href="/framework-9e781fccd75ff5481224.js"/><link as="script" rel="preload" href="/app-f105d623e57e1f7dfdab.js"/><link as="script" rel="preload" href="/cb1608f2-ca4388ee8e429e33d3f6.js"/><link as="script" rel="preload" href="/commons-9c2d4dddac463212205f.js"/><link as="script" rel="preload" href="/component---src-templates-blog-details-js-7f0fa3e9e77ee4da962a.js"/><link as="fetch" rel="preload" href="/page-data/blogs/recorte-automatico-arcpy/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="layout"><nav><ul class="secciones"><a id="home" href="/"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="home" class="svg-inline--fa fa-home fa-w-18 fa-1x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentColor" d="M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"></path></svg></a><a href="/proyectos">Proyectos</a><a href="/competencias">Competencias</a><a href="/blogs">Blog</a><a href="/about">Sobre mí</a></ul></nav><main><main><h1>Recorte automatico de shapes con ArcPy</h1><h3>Python, SIG, ArcGIS</h3><div><p>La aplicación de Python en conjunto con ArcGIS permite facilitar numerosos procesos. Una de las tareas más comunes al comenzar un nuevo proyecto corresponde a la necesidad de clipear varios archivos para acotarlos a un área de estudio. En este caso crearemos un script que permitirá, sin necesidad de abrir ArcMap, el "clip" o "recorte" de todos los archivos .shp en una carpeta arbitraria y las subcarpetas que ésta contenga. Para este proceso se usará el módulo os, que permite interactuar con el sistema operativo y ArcPy para el geoprocesamiento.</p>
<p><em>Nota: Las versiones preliminares a ArcGIS Pro estan basadas en Python 2.7, por lo que algunas de las sintaxis variarán respecto a las versiones más recientes. Resultados similares pueden lograrse mediante la librería geopandas.</em></p>
<p>Necesitaremos importar en primer lugar:</p>
<deckgo-highlight-code language="python" terminal="carbon" theme="monokai" line-numbers="true"  >
          <code slot="code">import os
from os.path import basename, join, splitext
import arcpy</code>
        </deckgo-highlight-code>
<h2>Encontrando los archivos de formato shape (.shp)</h2>
<p>El primer paso corresponde a encontrar todos los archivos de formato .shp existentes en un carpeta y las subcarpetas que esta contenga, para ello se crea una función que dada una carpeta arbitraria nos entregue una lista con las rutas de los archivos a clipear:</p>
<deckgo-highlight-code language="python" terminal="carbon" theme="monokai" line-numbers="true"  >
          <code slot="code">def shape_finder(carpeta):
    lista_rutas_shp = []
    for rutas, carpetas, archivos in os.walk(carpeta):
        for archivo in archivos:
            if splitext(archivo)[1] == &#39;.shp&#39;:
                lista_rutas_shp.append(join(rutas, archivo))
    return lista_rutas_shp

# Lista de carpetas a partir de input
carpeta_entrada = raw_input(&#39;Ruta de la carpeta con shapes a clipear: &#39;)
lista_rutas_shp = shape_finder(carpeta_entrada)</code>
        </deckgo-highlight-code>
<p>Dentro de la función <code>shape_finder()</code> se crea en primer lugar una lista que guardará las rutas de todos los archivos de terminación ".shp" presentes (<code>lista_rutas_shp</code>). Para navegar la carpeta de entrada en busca de los shape se utiliza el método <code>os.walk()</code>, el cual entrega todas las rutas, y las carpetas y archivos asociados. En este caso nos interesan solo los archivos de terminación .shp, para filtrarlos utilizamos <code>os.path.splitext()</code> que entrega el nombre y extensión del archivo, y en donde utilizaremos solo la extension (correspondiente al segundo elemento, de índice 1).</p>
<p>La ruta de nuestro shape corresponde a la ruta de la carpeta donde se encuentra sumado al nombre del archivo, los que son unidos mediante <code>os.path.join()</code>, para ser luego agregados a nuestra lista mediante <code>append()</code>. Por último, para poder ingresar la carpeta deseada al momento de ejecutar el script asignamos nuestra carpeta de entrada a un input (<code>raw_input</code>) y posteriormente ejecutamos la función y guardamos la lista en una variable (<code>lista_rutas_shp</code>).</p>
<h2>Realizando el clip con ArcPy</h2>
<p>Con la lista de rutas procedemos a utilizar ArcPy para el proceso de clip, ArcPy nos permite acceder a las herramientas normalmente disponibles desde la ArcToolbox, los detalles de la herramienta clip y ejemplos pueden ser revisados en la <a href="https://desktop.arcgis.com/es/arcmap/10.3/tools/analysis-toolbox/clip.htm">página oficial de ESRI</a>, donde se indica que la sintaxis sigue el formato:</p>
<deckgo-highlight-code language="python" terminal="carbon" theme="monokai" line-numbers="true"  >
          <code slot="code">Clip_analysis (in_features, clip_features, out_feature_class, {cluster_tolerance})</code>
        </deckgo-highlight-code>
<p>Donde <code>in_features</code> corresponden a las entidades a recortar, <code>clip_features</code> al objeto que recorta y <code>out_feature_class</code> a la entidad a crear. En este caso nuestras entidades a recortar corresponde a cada uno de los elementos de la lista de shapes, el archivo de clip será a elección, y la entidad de salida se designará con el nombre de "clip_" + nombre del archivo (obtenido mediante <code>os.path.basename</code>) y asociado a una carpeta donde dejaremos todos nuestros nuevos archivos recortados (<code>carpeta_salida</code>). Así:</p>
<deckgo-highlight-code language="python" terminal="carbon" theme="monokai" line-numbers="true"  >
          <code slot="code">archivo_clip = raw_input(&#39;Ruta del archivo a utilizar para el recorte: &#39;)

carpeta_salida = raw_input(&#39;Ruta de la carpeta de salida: &#39;)

for shape in lista_rutas_shp:
    ruta_archivo_salida = join(carpeta_salida, &#39;clip_&#39; + basename(shape))
    arcpy.Clip_analysis(shape, archivo_clip, ruta_archivo_salida) 
    print(&#39;{shp_nombre} clip exitoso!&#39;.format(shp_nombre=basename(shape)))</code>
        </deckgo-highlight-code>
<p>Finalmente podemos guardar nuestro script en el lugar que deseeamos, y posteriormente ser ejecutado en la consola con el interprete de python asociado a la versión de ArcGIS instalada, resultando en algo similar a:</p>
<deckgo-highlight-code language="bash" terminal="carbon" theme="monokai" line-numbers="true"  >
          <code slot="code">C:\Python27\ArcGIS10.5\python.exe C:/Users/usuario/PythonProjects/arcgisscriptclip/clipper.py</code>
        </deckgo-highlight-code></div></main></main></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blogs/recorte-automatico-arcpy";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-fd41d3bba3dba0c60639.js"],"app":["/app-f105d623e57e1f7dfdab.js"],"component---src-pages-404-js":["/component---src-pages-404-js-aedf3328bc3aaa89f8e1.js"],"component---src-pages-about-js":["/component---src-pages-about-js-cd2d21b3ea07109a3f98.js"],"component---src-pages-blogs-js":["/component---src-pages-blogs-js-e6e18e8fd4ae222a913f.js"],"component---src-pages-competencias-js":["/component---src-pages-competencias-js-1c524db73590bccfa876.js"],"component---src-pages-index-js":["/component---src-pages-index-js-6777b10ac83c0a2a3a88.js"],"component---src-pages-proyectos-js":["/component---src-pages-proyectos-js-96b5c491e29c260625dc.js"],"component---src-templates-blog-details-js":["/component---src-templates-blog-details-js-7f0fa3e9e77ee4da962a.js"]};/*]]>*/</script><script src="/polyfill-fd41d3bba3dba0c60639.js" nomodule=""></script><script src="/component---src-templates-blog-details-js-7f0fa3e9e77ee4da962a.js" async=""></script><script src="/commons-9c2d4dddac463212205f.js" async=""></script><script src="/cb1608f2-ca4388ee8e429e33d3f6.js" async=""></script><script src="/app-f105d623e57e1f7dfdab.js" async=""></script><script src="/framework-9e781fccd75ff5481224.js" async=""></script><script src="/webpack-runtime-6954d3e3ead096298f99.js" async=""></script></body></html>