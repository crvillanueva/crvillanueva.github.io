<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.40e7146fab396b6803a4.css" id="gatsby-global-css">@import url(https://fonts.googleapis.com/css2?family=Exo:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap);*,:after,:before{margin:0;padding:0;box-sizing:border-box}:root{--bg-primario:#151519;--bg-primario-l:#3b3b45;--bg-primario-d:#121216;--txt-primario:#f7f7f7;--txt-sec:#ababab;--acento-primario:#ff941a;--acento-primario-d:#ff8a05;--box-shadow:2px 2px 10px 1px rgba(78,78,78,0.15);--t-transicion:250ms;--radio-borde:1rem}body{background-color:var(--bg-primario);color:var(--txt-primario);font-family:Exo,sans-serif}h1,h2,h3{margin:.5rem 0}h2,h3,h4{color:var(--txt-sec);font-weight:400}h1{font-size:clamp(1.5rem,8vw,2.5rem);font-weight:500}a{text-decoration:none;color:var(--txt-primario)}hr{margin:.5rem 5px}p{margin:1rem 0}main{max-width:1100px;margin:auto;padding:0 1rem 1rem}img{background-color:#fff}.svg-inline--fa{margin:5px;font-size:1.2rem;transition:transform var(--t-transicion)}.svg-inline--fa:hover{color:#f0ec00}.svg-inline--fa.fa-moon,.svg-inline--fa.fa-sun{padding:.2em;font-size:3rem;border:1px solid var(--txt-primario);border-radius:50%}.layout nav ul{width:100%}@media(min-width:992px){.layout nav ul{display:grid;grid-template-columns:1fr repeat(4,2fr)}}.layout nav a{display:flex;justify-content:center;align-items:center;padding:1rem 2rem;height:4rem;letter-spacing:.25rem;text-transform:uppercase;font-weight:600;transition:scale .5s}.layout nav a:not(#home){display:none}@media(min-width:992px){.layout nav a:not(#home){display:flex}}.layout nav a:hover{box-shadow:var(--box-shadow);background-color:var(--acento-primario)}.layout nav a:hover svg{transform:scale(1.15);color:#fff}@media(min-width:992px){.layout nav{display:flex;justify-content:center;align-items:center}}.layout .fa-home{font-size:1.75rem}.top{display:flex;flex-direction:column-reverse;align-items:center;background-color:var(--bg-primario);width:100%;padding:1rem}@media(min-width:992px){.top{display:grid;grid-template-columns:1fr 1fr 1fr;place-items:center}}.nombre-titulo{display:flex;flex-direction:column;justify-content:center;align-items:center}.nombre-titulo h1{font-size:2rem}.top-iconos{display:flex}.top-iconos svg{font-size:1.3rem}@media(min-width:992px){.top-iconos{display:flex;margin:0 auto 0 1rem}}.top-iconos a{opacity:0;animation:inLeft 1s forwards;animation-delay:calc(var(--order)*300ms)}.home,.top-iconos a{display:flex;align-items:center}.home{flex-direction:column;height:100vh}.home nav{display:grid;place-items:center stretch;grid-template-rows:repeat(4,1fr);gap:1rem;height:100%;width:100%;padding:1rem 0}@media(min-width:992px){.home nav{display:grid;grid-template-columns:1fr 1fr;grid-template-rows:1fr 1fr}}.home nav a{display:flex;justify-content:center;align-items:center;margin:0 .5rem;text-transform:uppercase;font-size:clamp(2.25rem,10vw,4rem);text-shadow:3px 3px 10px hsla(0,0%,70.2%,.35);height:100%;border-radius:1rem;box-shadow:var(--box-shadow)}.home nav a:hover{color:var(--txt-primario);text-decoration:underline;text-underline-offset:.3ch;text-shadow:5px 5px 10px rgba(0,0,0,.781);background:#833ab4;background:linear-gradient(90deg,#833ab4,rgba(253,29,29,.75) 50%,#fcb045)}.toggle-mode{display:flex;align-items:center;margin:0 1rem}.toggle-mode span{display:none}@media(min-width:992px){.toggle-mode{margin-left:auto;max-width:100%}}.titulo{opacity:0;animation:inLeft .4s ease-out forwards;animation-delay:.1s;text-align:center}.grid-proyectos{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:1rem;margin:0 15px}.card{display:flex;flex-direction:column;align-items:center;justify-content:space-between;width:100%;height:100%;border:1px solid var(--bg-primario-l);border-radius:var(--radio-borde)}.card img{max-width:100%;border-radius:var(--radio-borde) var(--radio-borde) 0 0}.card .titulo-proyecto{width:100%;text-align:center;font-size:1.3rem;font-weight:500;margin:1rem 0;padding-bottom:.75rem;border-bottom:1px solid hsla(0,0%,82.7%,.5)}.tecnologias-proyecto{display:flex;justify-content:center;align-items:center;flex-wrap:wrap;margin:.5rem .25rem;width:100%;height:2.5rem;font-size:1rem;font-style:italic}.tecnologias-proyecto li{margin:0 1rem;list-style-type:none}.links-proyecto{display:flex;justify-content:space-between;align-items:center;width:100%;padding:.5rem 10px;font-size:.8rem;background-color:var(--bg-primario-l);border-radius:0 0 var(--radio-borde) var(--radio-borde)}.links-proyecto svg{margin:0 .3rem}.links-proyecto a:hover{display:flex;justify-content:space-between;align-items:center;color:var(--acento-primario)}.competencias{display:flex;justify-content:space-around;align-items:center;flex-wrap:wrap}.competencias svg{height:3rem;transition:transform var(--t-transicion)}.competencia{display:flex;align-items:center;margin:1rem;opacity:0}.competencia span{margin-left:1ch}.competencia:hover svg{transform:scale(1.2)}.competencia:first-child{animation:inLeft 1s ease-out forwards;animation-delay:.12s}.competencia:nth-child(2){animation:inLeft 1s ease-out forwards;animation-delay:.24s}.competencia:nth-child(3){animation:inLeft 1s ease-out forwards;animation-delay:.36s}.competencia:nth-child(4){animation:inLeft 1s ease-out forwards;animation-delay:.48s}.competencia:nth-child(5){animation:inLeft 1s ease-out forwards;animation-delay:.6s}.competencia:nth-child(6){animation:inLeft 1s ease-out forwards;animation-delay:.72s}.competencia:nth-child(7){animation:inLeft 1s ease-out forwards;animation-delay:.84s}#react svg{animation:App-logo-spin 20s linear infinite}#git{transition:all var(--t-transicion);fill:#fff}#git:hover{fill:#ff7b23}.viz{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1rem;margin:0 15px;place-items:center}.viz .wide{grid-column:span 2/auto}.blog .blog-article{border-bottom:1px solid hsla(0,0%,69%,.5)}.blog a{margin:.3rem 0;padding:.5rem;background-color:var(--acento-primario);border-radius:var(--radio-borde);display:flex;justify-content:center;align-items:center;width:100%}.blog a:hover{background-color:var(--acento-primario-d)}.light-theme{--bg-primario:#f8f5f2;--bg-primario-l:#e4e1de;--txt-primario:#151519;--txt-sec:#0e0e11;--acento-primario:#077e7e;--acento-primario-d:#f68374;--box-shadow:2px 2px 10px 1px rgba(0,0,0,0.25)}.light-theme #git{fill:#000}.light-theme #git:hover{fill:#ff7b23}@keyframes inLeft{20%{opacity:0;transform:translateX(-20%)}to{opacity:1;transform:translateX(0)}}@keyframes App-logo-spin{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}table{margin:1rem auto;border:1px solid}table td{padding:0 1ch}.blog-content a{color:#ff941a}</style><meta name="generator" content="Gatsby 3.4.1"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><title data-react-helmet="true"></title><link as="script" rel="preload" href="/webpack-runtime-1a5eb85b1f3187ab8235.js"/><link as="script" rel="preload" href="/framework-9e781fccd75ff5481224.js"/><link as="script" rel="preload" href="/app-1e9af9627b9fe6f2204c.js"/><link as="script" rel="preload" href="/cb1608f2-ca4388ee8e429e33d3f6.js"/><link as="script" rel="preload" href="/commons-9c2d4dddac463212205f.js"/><link as="script" rel="preload" href="/d8845bf408884940aa63864376844539580f2120-59547ad4b8d8235cbf3d.js"/><link as="script" rel="preload" href="/component---src-templates-blog-details-js-aec98c96452837dddadb.js"/><link as="fetch" rel="preload" href="/page-data/blogs/recorte-automatico-arcpy/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="layout"><nav><ul class="secciones"><a id="home" href="/"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="home" class="svg-inline--fa fa-home fa-w-18 fa-1x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentColor" d="M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"></path></svg></a><a href="/proyectos">Proyectos</a><a href="/competencias">Competencias</a><a href="/blogs">Blog</a><a href="/about">Sobre mí</a></ul></nav><main><main><h1>Recorte automatico de shapes con ArcPy</h1><h3>Python, SIG, ArcGIS</h3><div class="blog-content"><p>La aplicación de Python en conjunto con ArcGIS permite facilitar numerosos procesos. Una de las tareas más comunes al comenzar un nuevo proyecto corresponde a la necesidad de clipear varios archivos para acotarlos a un área de estudio. En este caso crearemos un script que permitirá, sin necesidad de abrir ArcMap, el "clip" o "recorte" de todos los archivos .shp en una carpeta arbitraria y las subcarpetas que ésta contenga. Para este proceso se usará el módulo os, que permite interactuar con el sistema operativo y ArcPy para el geoprocesamiento.</p>
<p><em>Nota: Las versiones preliminares a ArcGIS Pro estan basadas en Python 2.7, por lo que algunas de las sintaxis variarán respecto a las versiones más recientes. Resultados similares pueden lograrse mediante la librería geopandas.</em></p>
<p>Necesitaremos importar en primer lugar:</p>
<deckgo-highlight-code language="python" terminal="carbon" theme="monokai" line-numbers="true"  >
          <code slot="code">import os
from os.path import basename, join, splitext
import arcpy</code>
        </deckgo-highlight-code>
<h2>Encontrando los archivos de formato shape (.shp)</h2>
<p>El primer paso corresponde a encontrar todos los archivos de formato .shp existentes en un carpeta y las subcarpetas que esta contenga, para ello se crea una función que dada una carpeta arbitraria nos entregue una lista con las rutas de los archivos a clipear:</p>
<deckgo-highlight-code language="python" terminal="carbon" theme="monokai" line-numbers="true"  >
          <code slot="code">def shape_finder(carpeta):
    lista_rutas_shp = []
    for rutas, carpetas, archivos in os.walk(carpeta):
        for archivo in archivos:
            if splitext(archivo)[1] == &#39;.shp&#39;:
                lista_rutas_shp.append(join(rutas, archivo))
    return lista_rutas_shp

# Lista de carpetas a partir de input
carpeta_entrada = raw_input(&#39;Ruta de la carpeta con shapes a clipear: &#39;)
lista_rutas_shp = shape_finder(carpeta_entrada)</code>
        </deckgo-highlight-code>
<p>Dentro de la función <code>shape_finder()</code> se crea en primer lugar una lista que guardará las rutas de todos los archivos de terminación ".shp" presentes (<code>lista_rutas_shp</code>). Para navegar la carpeta de entrada en busca de los shape se utiliza el método <code>os.walk()</code>, el cual entrega todas las rutas, y las carpetas y archivos asociados. En este caso nos interesan solo los archivos de terminación .shp, para filtrarlos utilizamos <code>os.path.splitext()</code> que entrega el nombre y extensión del archivo, y en donde utilizaremos solo la extension (correspondiente al segundo elemento, de índice 1).</p>
<p>La ruta de nuestro shape corresponde a la ruta de la carpeta donde se encuentra sumado al nombre del archivo, los que son unidos mediante <code>os.path.join()</code>, para ser luego agregados a nuestra lista mediante <code>append()</code>. Por último, para poder ingresar la carpeta deseada al momento de ejecutar el script asignamos nuestra carpeta de entrada a un input (<code>raw_input</code>) y posteriormente ejecutamos la función y guardamos la lista en una variable (<code>lista_rutas_shp</code>).</p>
<h2>Realizando el clip con ArcPy</h2>
<p>Con la lista de rutas procedemos a utilizar ArcPy para el proceso de clip, ArcPy nos permite acceder a las herramientas normalmente disponibles desde la ArcToolbox, los detalles de la herramienta clip y ejemplos pueden ser revisados en la <a href="https://desktop.arcgis.com/es/arcmap/10.3/tools/analysis-toolbox/clip.htm">página oficial de ESRI</a>, donde se indica que la sintaxis sigue el formato:</p>
<deckgo-highlight-code language="python" terminal="carbon" theme="monokai" line-numbers="true"  >
          <code slot="code">Clip_analysis (in_features, clip_features, out_feature_class, {cluster_tolerance})</code>
        </deckgo-highlight-code>
<p>Donde <code>in_features</code> corresponden a las entidades a recortar, <code>clip_features</code> al objeto que recorta y <code>out_feature_class</code> a la entidad a crear. En este caso nuestras entidades a recortar corresponde a cada uno de los elementos de la lista de shapes, el archivo de clip será a elección, y la entidad de salida se designará con el nombre de "clip_" + nombre del archivo (obtenido mediante <code>os.path.basename</code>) y asociado a una carpeta donde dejaremos todos nuestros nuevos archivos recortados (<code>carpeta_salida</code>). Así:</p>
<deckgo-highlight-code language="python" terminal="carbon" theme="monokai" line-numbers="true"  >
          <code slot="code">archivo_clip = raw_input(&#39;Ruta del archivo a utilizar para el recorte: &#39;)

carpeta_salida = raw_input(&#39;Ruta de la carpeta de salida: &#39;)

for shape in lista_rutas_shp:
    ruta_archivo_salida = join(carpeta_salida, &#39;clip_&#39; + basename(shape))
    arcpy.Clip_analysis(shape, archivo_clip, ruta_archivo_salida) 
    print(&#39;{shp_nombre} clip exitoso!&#39;.format(shp_nombre=basename(shape)))</code>
        </deckgo-highlight-code>
<p>Finalmente podemos guardar nuestro script en el lugar que deseeamos, y posteriormente ser ejecutado en la consola con el interprete de python asociado a la versión de ArcGIS instalada, resultando en algo similar a:</p>
<deckgo-highlight-code language="bash" terminal="carbon" theme="monokai" line-numbers="true"  >
          <code slot="code">C:\Python27\ArcGIS10.5\python.exe C:/Users/usuario/PythonProjects/arcgisscriptclip/clipper.py</code>
        </deckgo-highlight-code></div></main></main></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blogs/recorte-automatico-arcpy";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-fd41d3bba3dba0c60639.js"],"app":["/app-1e9af9627b9fe6f2204c.js"],"component---src-pages-404-js":["/component---src-pages-404-js-aedf3328bc3aaa89f8e1.js"],"component---src-pages-about-js":["/component---src-pages-about-js-cd2d21b3ea07109a3f98.js"],"component---src-pages-blogs-js":["/component---src-pages-blogs-js-e6e18e8fd4ae222a913f.js"],"component---src-pages-competencias-js":["/component---src-pages-competencias-js-1c524db73590bccfa876.js"],"component---src-pages-index-js":["/component---src-pages-index-js-7d3e57a1837941a0a75a.js"],"component---src-pages-proyectos-js":["/component---src-pages-proyectos-js-96b5c491e29c260625dc.js"],"component---src-templates-blog-details-js":["/component---src-templates-blog-details-js-aec98c96452837dddadb.js"]};/*]]>*/</script><script src="/polyfill-fd41d3bba3dba0c60639.js" nomodule=""></script><script src="/component---src-templates-blog-details-js-aec98c96452837dddadb.js" async=""></script><script src="/d8845bf408884940aa63864376844539580f2120-59547ad4b8d8235cbf3d.js" async=""></script><script src="/commons-9c2d4dddac463212205f.js" async=""></script><script src="/cb1608f2-ca4388ee8e429e33d3f6.js" async=""></script><script src="/app-1e9af9627b9fe6f2204c.js" async=""></script><script src="/framework-9e781fccd75ff5481224.js" async=""></script><script src="/webpack-runtime-1a5eb85b1f3187ab8235.js" async=""></script></body></html>