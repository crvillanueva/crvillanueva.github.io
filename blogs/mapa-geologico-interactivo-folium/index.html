<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.8dbc79a054cd1d1a9f67.css" id="gatsby-global-css">@import url(https://fonts.googleapis.com/css2?family=Exo:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap);*,:after,:before{margin:0;padding:0;box-sizing:border-box}:root{--bg-primario:#151519;--bg-primario-l:#3b3b45;--bg-primario-d:#121216;--txt-primario:#f7f7f7;--txt-sec:#ababab;--acento-primario:#ff941a;--acento-primario-d:#ff8a05;--box-shadow:2px 2px 10px 1px rgba(78,78,78,0.15);--t-transicion:250ms;--radio-borde:1rem}body{background-color:var(--bg-primario);color:var(--txt-primario);font-family:Exo,sans-serif}h1,h2,h3{margin:.5rem 0}h2,h3,h4{color:var(--txt-sec);font-weight:400}h1{font-size:clamp(1.5rem,8vw,2.5rem);font-weight:500}a{text-decoration:none;color:var(--txt-primario)}hr{margin:.5rem 5px}p{margin:1rem 0}main{max-width:1100px;margin:auto;padding:0 1rem 1rem}img{background-color:#fff}.svg-inline--fa{margin:5px;font-size:1.2rem;transition:transform var(--t-transicion)}.svg-inline--fa:hover{color:#f0ec00}.svg-inline--fa.fa-moon,.svg-inline--fa.fa-sun{padding:.2em;font-size:3rem;border:1px solid var(--txt-primario);border-radius:50%}.layout nav ul{width:100%}@media(min-width:992px){.layout nav ul{display:grid;grid-template-columns:1fr repeat(4,2fr)}}.layout nav a{display:flex;justify-content:center;align-items:center;padding:1rem 2rem;height:4rem;letter-spacing:.25rem;text-transform:uppercase;font-weight:600;transition:scale .5s}.layout nav a:not(#home){display:none}@media(min-width:992px){.layout nav a:not(#home){display:flex}}.layout nav a:hover{box-shadow:var(--box-shadow);background-color:var(--acento-primario)}.layout nav a:hover svg{transform:scale(1.15);color:#fff}@media(min-width:992px){.layout nav{display:flex;justify-content:center;align-items:center}}.layout .fa-home{font-size:1.75rem}.top{display:flex;flex-direction:column-reverse;align-items:center;background-color:var(--bg-primario);width:100%;padding:1rem}@media(min-width:992px){.top{display:grid;grid-template-columns:1fr 1fr 1fr;place-items:center}}.nombre-titulo{display:flex;flex-direction:column;justify-content:center;align-items:center}.nombre-titulo h1{font-size:2rem}.top-iconos{display:flex}.top-iconos svg{font-size:1.3rem}@media(min-width:992px){.top-iconos{display:flex;margin:0 auto 0 1rem}}.top-iconos a{opacity:0;animation:inLeft 1s forwards;animation-delay:calc(var(--order)*300ms)}.home,.top-iconos a{display:flex;align-items:center}.home{flex-direction:column;height:100vh}.home nav{display:grid;place-items:center stretch;grid-template-rows:repeat(4,1fr);gap:1rem;height:100%;width:100%;padding:1rem 0}@media(min-width:992px){.home nav{display:grid;grid-template-columns:1fr 1fr;grid-template-rows:1fr 1fr}}.home nav a{display:flex;justify-content:center;align-items:center;margin:0 .5rem;text-transform:uppercase;font-size:clamp(2.25rem,10vw,4rem);text-shadow:3px 3px 10px hsla(0,0%,70.2%,.35);height:100%;border-radius:1rem;box-shadow:var(--box-shadow)}.home nav a:hover{color:var(--txt-primario);text-decoration:underline;text-underline-offset:.3ch;text-shadow:5px 5px 10px rgba(0,0,0,.781);background:#833ab4;background:linear-gradient(90deg,#833ab4,rgba(253,29,29,.75) 50%,#fcb045)}.toggle-mode{display:flex;align-items:center;margin:0 1rem}.toggle-mode span{display:none}@media(min-width:992px){.toggle-mode{margin-left:auto;max-width:100%}}.titulo{opacity:0;animation:inLeft .4s ease-out forwards;animation-delay:.1s;text-align:center}.grid-proyectos{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:1rem;margin:0 15px}.card{display:flex;flex-direction:column;align-items:center;justify-content:space-between;width:100%;height:100%;border:1px solid var(--bg-primario-l);border-radius:var(--radio-borde)}.card img{max-width:100%;border-radius:var(--radio-borde) var(--radio-borde) 0 0}.card .titulo-proyecto{width:100%;text-align:center;font-size:1.3rem;font-weight:500;margin:1rem 0;padding-bottom:.75rem;border-bottom:1px solid hsla(0,0%,82.7%,.5)}.tecnologias-proyecto{display:flex;justify-content:center;align-items:center;flex-wrap:wrap;margin:.5rem .25rem;width:100%;height:2.5rem;font-size:1rem;font-style:italic}.tecnologias-proyecto li{margin:0 1rem;list-style-type:none}.links-proyecto{display:flex;justify-content:space-between;align-items:center;width:100%;padding:.5rem 10px;font-size:.8rem;background-color:var(--bg-primario-l);border-radius:0 0 var(--radio-borde) var(--radio-borde)}.links-proyecto svg{margin:0 .3rem}.links-proyecto a:hover{display:flex;justify-content:space-between;align-items:center;color:var(--acento-primario)}.competencias{display:flex;justify-content:space-around;align-items:center;flex-wrap:wrap}.competencias svg{height:3rem;transition:transform var(--t-transicion)}.competencia{display:flex;align-items:center;margin:1rem;opacity:0}.competencia span{margin-left:1ch}.competencia:hover svg{transform:scale(1.2)}.competencia:first-child{animation:inLeft 1s ease-out forwards;animation-delay:.12s}.competencia:nth-child(2){animation:inLeft 1s ease-out forwards;animation-delay:.24s}.competencia:nth-child(3){animation:inLeft 1s ease-out forwards;animation-delay:.36s}.competencia:nth-child(4){animation:inLeft 1s ease-out forwards;animation-delay:.48s}.competencia:nth-child(5){animation:inLeft 1s ease-out forwards;animation-delay:.6s}.competencia:nth-child(6){animation:inLeft 1s ease-out forwards;animation-delay:.72s}.competencia:nth-child(7){animation:inLeft 1s ease-out forwards;animation-delay:.84s}#react svg{animation:App-logo-spin 20s linear infinite}#git{transition:all var(--t-transicion);fill:#fff}#git:hover{fill:#ff7b23}.viz{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1rem;margin:0 15px;place-items:center}.viz .wide{grid-column:span 2/auto}.blog .blog-article{border-bottom:1px solid hsla(0,0%,69%,.5)}.blog a{margin:.3rem 0;padding:.5rem;background-color:var(--acento-primario);border-radius:var(--radio-borde);display:flex;justify-content:center;align-items:center;width:100%}.blog a:hover{background-color:var(--acento-primario-d)}.light-theme{--bg-primario:#f8f5f2;--bg-primario-l:#e4e1de;--txt-primario:#151519;--txt-sec:#0e0e11;--acento-primario:#077e7e;--acento-primario-d:#f68374;--box-shadow:2px 2px 10px 1px rgba(0,0,0,0.25)}.light-theme #git{fill:#000}.light-theme #git:hover{fill:#ff7b23}@keyframes inLeft{20%{opacity:0;transform:translateX(-20%)}to{opacity:1;transform:translateX(0)}}@keyframes App-logo-spin{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}table{margin:1rem auto;border:1px solid}table td{padding:0 1ch}</style><meta name="generator" content="Gatsby 3.4.1"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><title data-react-helmet="true"></title><link as="script" rel="preload" href="/webpack-runtime-43d666036d29aba1d707.js"/><link as="script" rel="preload" href="/framework-9e781fccd75ff5481224.js"/><link as="script" rel="preload" href="/app-7b840dce4fee86e3e8f3.js"/><link as="script" rel="preload" href="/cb1608f2-ca4388ee8e429e33d3f6.js"/><link as="script" rel="preload" href="/commons-9c2d4dddac463212205f.js"/><link as="script" rel="preload" href="/component---src-templates-blog-details-js-7f0fa3e9e77ee4da962a.js"/><link as="fetch" rel="preload" href="/page-data/blogs/mapa-geologico-interactivo-folium/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="layout"><nav><ul class="secciones"><a id="home" href="/"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="home" class="svg-inline--fa fa-home fa-w-18 fa-1x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentColor" d="M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"></path></svg></a><a href="/proyectos">Proyectos</a><a href="/competencias">Competencias</a><a href="/blogs">Blog</a><a href="/about">Sobre mí</a></ul></nav><main><main><h1>Mapa geológico interactivo con Folium</h1><h3>Python, Mapas, geopandas, folium</h3><div><p>En esta ocasión, utilizaremos las librerías <code>Folium</code> y  <code>geopandas</code> para la creación de un mapa geológico interactivo a partir de un archivo shapefile. El resultado final se muestra a continuación:</p>
<iframe src="/html/mapa_geologico.html" id="mapa" title="mapa geologico interactivo" height=500 width="100%"></iframe>
<h2>Instalación de las librerías</h2>
<p><a href="https://python-visualization.github.io/folium/"><code>folium</code></a> nos permitirá la creación de mapas livianos e interactivos totalmente compatibles con el navegador. Por otro lado, debido a que Folium no acepta el formato shape (.shp) directamente, será necesario utilizar <a href="https://geopandas.org/"><code>geopandas</code></a> para la carga y transformación de nuestro archivo.</p>
<p>Para instalar las librerías es posible utilizar pip:</p>
<deckgo-highlight-code language="python" terminal="carbon" theme="monokai" line-numbers="true"  >
          <code slot="code">pip install geopandas folium</code>
        </deckgo-highlight-code>
<p>O si utilizas en Anaconda:</p>
<deckgo-highlight-code language="bash" terminal="carbon" theme="monokai" line-numbers="true"  >
          <code slot="code">conda install -c conda-forge geopandas folium</code>
        </deckgo-highlight-code>
<p>Luego de instaladas se importan las librerías:</p>
<deckgo-highlight-code language="python" terminal="carbon" theme="monokai" line-numbers="true"  >
          <code slot="code">import geopandas as gpd
import folium</code>
        </deckgo-highlight-code>
<p>* Se recomienda la creación de un ambiente virtual para la instalación de las librerías. Para mayores detalles sobre los ambientes virtuales visita la <a href="https://docs.python.org/3/library/venv.html">documentación oficial de Python</a>.</p>
<h2>Carga y transformación de datos</h2>
<p>En primer lugar, cargaremos nuestro archivo shape con la ayuda de <code>geopandas.read_file()</code>, este método nos entrega un <code>GeoDataFrame</code> que contiene la geometría y la información tabular asociada al archivo shape.</p>
<deckgo-highlight-code language="python" terminal="carbon" theme="monokai" line-numbers="true"  >
          <code slot="code"># Carga de datos
shp_geologia = gpd.read_file(&quot;data/geologia_tumbes.shp&quot;)
print(shp_geologia)</code>
        </deckgo-highlight-code>
<table>
<thead>
<tr>
<th align="right"></th>
<th align="right">unidad_geo</th>
<th align="right">geometry</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">0</td>
<td align="right">Depósitos Fluviales y Litorales</td>
<td align="right">MULTIPOLYGON (((-72.99436 -36.73458, -72.99422...</td>
</tr>
<tr>
<td align="right">1</td>
<td align="right">Batolito Costero del Sur</td>
<td align="right">MULTIPOLYGON (((-72.99405 -36.74629, -72.99269...</td>
</tr>
<tr>
<td align="right">2</td>
<td align="right">Formación Cosmito</td>
<td align="right">MULTIPOLYGON (((-73.01919 -36.79901, -73.02318...</td>
</tr>
<tr>
<td align="right">3</td>
<td align="right">Formación Andalién</td>
<td align="right">MULTIPOLYGON (((-73.05011 -36.78331, -73.04993...</td>
</tr>
<tr>
<td align="right">4</td>
<td align="right">Plutón Hualpén</td>
<td align="right">MULTIPOLYGON (((-73.19121 -36.74677, -73.19089...</td>
</tr>
<tr>
<td align="right">5</td>
<td align="right">Formación Quiriquina</td>
<td align="right">MULTIPOLYGON (((-72.99422 -36.73964, -72.99405...</td>
</tr>
<tr>
<td align="right">6</td>
<td align="right">Serie Occidental</td>
<td align="right">MULTIPOLYGON (((-73.16328 -36.80132, -73.17814...</td>
</tr>
</tbody>
</table>
<p>Agregaremos además una nueva columna que tenga los colores de cada unidad geólogica (en este caso, en formato hexadecimal). Para esto necesitaremos un diccionario con los colores correspondientes, teniendo en cuenta que el nombre de la unidad debe coincidir exactamente con el que se define en el shape. Posteriormente, se crea una nueva columna y mediante el método <code>Series.map()</code>, el cual al ser aplicado en una serie reemplaza según una función o diccionario, se agregan los colores correspondientes a cada unidad a la tabla (más información sobre <code>Series.map</code> en la documentación oficial). Estos valores de color serán usados al momento de darle el estilo a nuestros polígonos en <code>folium</code>.</p>
<deckgo-highlight-code language="python" terminal="carbon" theme="monokai" line-numbers="true"  >
          <code slot="code"># Agregar columna con colores al GeoDataFrame
colores_unidades = {
    &#39;Depósitos Fluviales y Litorales&#39;: &#39;#fff2ae&#39;,
    &#39;Batolito Costero del Sur&#39;: &#39;#ef5845&#39;,
    &#39;Formación Andalién&#39;: &#39;#ffff00&#39;,
    &#39;Formación Cosmito&#39;: &#39;#a6611a&#39;,
    &#39;Formación Quiriquina&#39;: &#39;#5cff51&#39;,
    &#39;Plutón Hualpén&#39;: &#39;#d52dff&#39;,
    &#39;Serie Occidental&#39;: &#39;#5d5d5d&#39;,
}

geologia[&quot;color_unidad&quot;] = geologia[&quot;unidad_geologica&quot;].map(colores_unidades)
print(geologia)</code>
        </deckgo-highlight-code>
<table>
<thead>
<tr>
<th align="right"></th>
<th align="right">unidad_geo</th>
<th align="right">geometry</th>
<th>color</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">0</td>
<td align="right">Depósitos Fluviales y Litorales</td>
<td align="right">MULTIPOLYGON (((-72.99436 -36.73458, -72.99422...</td>
<td>#fff2ae</td>
</tr>
<tr>
<td align="right">1</td>
<td align="right">Batolito Costero del Sur</td>
<td align="right">MULTIPOLYGON (((-72.99405 -36.74629, -72.99269...</td>
<td>#ef5845</td>
</tr>
<tr>
<td align="right">2</td>
<td align="right">Formación Cosmito</td>
<td align="right">MULTIPOLYGON (((-73.01919 -36.79901, -73.02318...</td>
<td>#a6611a</td>
</tr>
<tr>
<td align="right">3</td>
<td align="right">Formación Andalién</td>
<td align="right">MULTIPOLYGON (((-73.05011 -36.78331, -73.04993...</td>
<td>#ffff00</td>
</tr>
<tr>
<td align="right">4</td>
<td align="right">Plutón Hualpén</td>
<td align="right">MULTIPOLYGON (((-73.19121 -36.74677, -73.19089...</td>
<td>#d52dff</td>
</tr>
<tr>
<td align="right">5</td>
<td align="right">Formación Quiriquina</td>
<td align="right">MULTIPOLYGON (((-72.99422 -36.73964, -72.99405...</td>
<td>#5cff51</td>
</tr>
<tr>
<td align="right">6</td>
<td align="right">Serie Occidental</td>
<td align="right">MULTIPOLYGON (((-73.16328 -36.80132, -73.17814...</td>
<td>#5d5d5d</td>
</tr>
</tbody>
</table>
<h2>Creación del mapa interactivo</h2>
<p>El siguiente paso corresponde a crear un objeto de mapa con <code>folium.Map()</code>. Esta clase nos permite durante la creación del objeto ajustar parámetros que determinarán las caracteristicas iniciales de nuestro mapa, en este caso <code>location</code> y <code>zoom_start</code> determinan el punto central del mapa y el nivel de acercamiento, respectivamente.</p>
<deckgo-highlight-code language="python" terminal="carbon" theme="monokai" line-numbers="true"  >
          <code slot="code"># Creacion de objeto mapa
mapa_geologico = folium.Map(location=[-36.7, -73.1], zoom_start=11)</code>
        </deckgo-highlight-code>
<p>Posteriormente, se creará un objeto por separado para cada unidad, lo cual nos permitirá asignarle el nombre de la capa y el color del polígono individualmente, además de permitirnos activar y desactivar la capa respectiva en el mapa final. Para esto se crea un nuevo GeoDataFrame para cada unidad (<code>gdf_unidad</code>), lo cual se logra filtrando el GeoDataFrame original según el nombre de cada unidad en particular (obtenido en este caso iterando las claves de nuestro diccionario de colores).</p>
<p>Cada unidad se transforma en un objeto interpretable por <code>folium</code> mediante  <code>folium.GeoJson()</code>, el cual acepta nuestra unidad en formato json, además de parámetros como el nombre, y una función de estilo, la que recibe una función que entregue un diccionario con los valores de estilo correspondientes, y donde se establece como color de relleno el valor de la columna de color definida anteriormente. Finalmente se agrega este objeto a nuestro objeto de mapa creado anteriormente (<code>mapa_geologico</code>), y se agrega también un control  de capas con <code>folium.LayerControl</code> que nos permitirá activar y desactivar cada unidad geológica por separado.</p>
<deckgo-highlight-code language="python" terminal="carbon" theme="monokai" line-numbers="true"  >
          <code slot="code">for unidad in colores_unidades.keys():
    gdf_unidad = geologia.loc[geologia[&quot;Nombre_Uni&quot;] == unidad]

    folium.GeoJson(
        gdf_unidad.to_json(),
        name=unidad,
        style_function=lambda json: {
            &quot;fillColor&quot;: json[&quot;properties&quot;][&quot;color_unidad&quot;],
            &quot;fillOpacity&quot;: 0.85,
            &quot;color&quot;: &quot;grey&quot;,
            &quot;weight&quot;: 0.5
        },
        tooltip=unidad
    ).add_to(mapa_geologico)

folium.LayerControl(collapsed=False).add_to(mapa_geologico)

mapa_geologico</code>
        </deckgo-highlight-code>
<p>Finalmente podemos guardar nuestro mapa en formato html para poder compartirlo o integrarlo en alguna página web.</p>
<deckgo-highlight-code language="python" terminal="carbon" theme="monokai" line-numbers="true"  >
          <code slot="code">mapa_geologico.save(&quot;mapa_geologico.html&quot;)</code>
        </deckgo-highlight-code></div></main></main></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blogs/mapa-geologico-interactivo-folium";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-fd41d3bba3dba0c60639.js"],"app":["/app-7b840dce4fee86e3e8f3.js"],"component---src-pages-404-js":["/component---src-pages-404-js-aedf3328bc3aaa89f8e1.js"],"component---src-pages-about-js":["/component---src-pages-about-js-cd2d21b3ea07109a3f98.js"],"component---src-pages-blogs-js":["/component---src-pages-blogs-js-e6e18e8fd4ae222a913f.js"],"component---src-pages-competencias-js":["/component---src-pages-competencias-js-1c524db73590bccfa876.js"],"component---src-pages-index-js":["/component---src-pages-index-js-6777b10ac83c0a2a3a88.js"],"component---src-pages-proyectos-js":["/component---src-pages-proyectos-js-96b5c491e29c260625dc.js"],"component---src-templates-blog-details-js":["/component---src-templates-blog-details-js-7f0fa3e9e77ee4da962a.js"]};/*]]>*/</script><script src="/polyfill-fd41d3bba3dba0c60639.js" nomodule=""></script><script src="/component---src-templates-blog-details-js-7f0fa3e9e77ee4da962a.js" async=""></script><script src="/commons-9c2d4dddac463212205f.js" async=""></script><script src="/cb1608f2-ca4388ee8e429e33d3f6.js" async=""></script><script src="/app-7b840dce4fee86e3e8f3.js" async=""></script><script src="/framework-9e781fccd75ff5481224.js" async=""></script><script src="/webpack-runtime-43d666036d29aba1d707.js" async=""></script></body></html>