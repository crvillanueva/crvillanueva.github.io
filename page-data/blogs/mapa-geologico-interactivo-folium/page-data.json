{"componentChunkName":"component---src-templates-blog-details-js","path":"/blogs/mapa-geologico-interactivo-folium","result":{"data":{"markdownRemark":{"html":"<p>En esta ocasión, utilizaremos las librerías <code>Folium</code> y  <code>geopandas</code> para la creación de un mapa geológico interactivo a partir de un archivo shapefile. El resultado final se muestra a continuación:</p>\n<iframe src=\"/html/mapa_geologico.html\" id=\"mapa\" title=\"mapa geologico interactivo\" height=500 width=\"100%\"></iframe>\n<h2>Instalación de las librerías</h2>\n<p><a href=\"https://python-visualization.github.io/folium/\"><code>folium</code></a> nos permitirá la creación de mapas livianos e interactivos totalmente compatibles con el navegador. Por otro lado, debido a que Folium no acepta el formato shape (.shp) directamente, será necesario utilizar <a href=\"https://geopandas.org/\"><code>geopandas</code></a> para la carga y transformación de nuestro archivo.</p>\n<p>Para instalar las librerías es posible utilizar pip:</p>\n<deckgo-highlight-code language=\"python\" terminal=\"carbon\" theme=\"monokai\" line-numbers=\"true\"  >\n          <code slot=\"code\">pip install geopandas folium</code>\n        </deckgo-highlight-code>\n<p>O si utilizas en Anaconda:</p>\n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" theme=\"monokai\" line-numbers=\"true\"  >\n          <code slot=\"code\">conda install -c conda-forge geopandas folium</code>\n        </deckgo-highlight-code>\n<p>Luego de instaladas se importan las librerías:</p>\n<deckgo-highlight-code language=\"python\" terminal=\"carbon\" theme=\"monokai\" line-numbers=\"true\"  >\n          <code slot=\"code\">import geopandas as gpd\r\nimport folium</code>\n        </deckgo-highlight-code>\n<p>* Se recomienda la creación de un ambiente virtual para la instalación de las librerías. Para mayores detalles sobre los ambientes virtuales visita la <a href=\"https://docs.python.org/3/library/venv.html\">documentación oficial de Python</a>.</p>\n<h2>Carga y transformación de datos</h2>\n<p>En primer lugar, cargaremos nuestro archivo shape con la ayuda de <code>geopandas.read_file()</code>, este método nos entrega un <code>GeoDataFrame</code> que contiene la geometría y la información tabular asociada al archivo shape.</p>\n<deckgo-highlight-code language=\"python\" terminal=\"carbon\" theme=\"monokai\" line-numbers=\"true\"  >\n          <code slot=\"code\"># Carga de datos\r\nshp_geologia = gpd.read_file(&quot;data/geologia_tumbes.shp&quot;)\r\nprint(shp_geologia)</code>\n        </deckgo-highlight-code>\n<table>\n<thead>\n<tr>\n<th align=\"right\"></th>\n<th align=\"right\">unidad_geo</th>\n<th align=\"right\">geometry</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"right\">0</td>\n<td align=\"right\">Depósitos Fluviales y Litorales</td>\n<td align=\"right\">MULTIPOLYGON (((-72.99436 -36.73458, -72.99422...</td>\n</tr>\n<tr>\n<td align=\"right\">1</td>\n<td align=\"right\">Batolito Costero del Sur</td>\n<td align=\"right\">MULTIPOLYGON (((-72.99405 -36.74629, -72.99269...</td>\n</tr>\n<tr>\n<td align=\"right\">2</td>\n<td align=\"right\">Formación Cosmito</td>\n<td align=\"right\">MULTIPOLYGON (((-73.01919 -36.79901, -73.02318...</td>\n</tr>\n<tr>\n<td align=\"right\">3</td>\n<td align=\"right\">Formación Andalién</td>\n<td align=\"right\">MULTIPOLYGON (((-73.05011 -36.78331, -73.04993...</td>\n</tr>\n<tr>\n<td align=\"right\">4</td>\n<td align=\"right\">Plutón Hualpén</td>\n<td align=\"right\">MULTIPOLYGON (((-73.19121 -36.74677, -73.19089...</td>\n</tr>\n<tr>\n<td align=\"right\">5</td>\n<td align=\"right\">Formación Quiriquina</td>\n<td align=\"right\">MULTIPOLYGON (((-72.99422 -36.73964, -72.99405...</td>\n</tr>\n<tr>\n<td align=\"right\">6</td>\n<td align=\"right\">Serie Occidental</td>\n<td align=\"right\">MULTIPOLYGON (((-73.16328 -36.80132, -73.17814...</td>\n</tr>\n</tbody>\n</table>\n<p>Agregaremos además una nueva columna que tenga los colores de cada unidad geólogica (en este caso, en formato hexadecimal). Para esto necesitaremos un diccionario con los colores correspondientes, teniendo en cuenta que el nombre de la unidad debe coincidir exactamente con el que se define en el shape. Posteriormente, se crea una nueva columna y mediante el método <code>Series.map()</code>, el cual al ser aplicado en una serie reemplaza según una función o diccionario, se agregan los colores correspondientes a cada unidad a la tabla (más información sobre <code>Series.map</code> en la documentación oficial). Estos valores de color serán usados al momento de darle el estilo a nuestros polígonos en <code>folium</code>.</p>\n<deckgo-highlight-code language=\"python\" terminal=\"carbon\" theme=\"monokai\" line-numbers=\"true\"  >\n          <code slot=\"code\"># Agregar columna con colores al GeoDataFrame\r\ncolores_unidades = {\r\n    &#39;Depósitos Fluviales y Litorales&#39;: &#39;#fff2ae&#39;,\r\n    &#39;Batolito Costero del Sur&#39;: &#39;#ef5845&#39;,\r\n    &#39;Formación Andalién&#39;: &#39;#ffff00&#39;,\r\n    &#39;Formación Cosmito&#39;: &#39;#a6611a&#39;,\r\n    &#39;Formación Quiriquina&#39;: &#39;#5cff51&#39;,\r\n    &#39;Plutón Hualpén&#39;: &#39;#d52dff&#39;,\r\n    &#39;Serie Occidental&#39;: &#39;#5d5d5d&#39;,\r\n}\r\n\r\ngeologia[&quot;color_unidad&quot;] = geologia[&quot;unidad_geologica&quot;].map(colores_unidades)\r\nprint(geologia)</code>\n        </deckgo-highlight-code>\n<table>\n<thead>\n<tr>\n<th align=\"right\"></th>\n<th align=\"right\">unidad_geo</th>\n<th align=\"right\">geometry</th>\n<th>color</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"right\">0</td>\n<td align=\"right\">Depósitos Fluviales y Litorales</td>\n<td align=\"right\">MULTIPOLYGON (((-72.99436 -36.73458, -72.99422...</td>\n<td>#fff2ae</td>\n</tr>\n<tr>\n<td align=\"right\">1</td>\n<td align=\"right\">Batolito Costero del Sur</td>\n<td align=\"right\">MULTIPOLYGON (((-72.99405 -36.74629, -72.99269...</td>\n<td>#ef5845</td>\n</tr>\n<tr>\n<td align=\"right\">2</td>\n<td align=\"right\">Formación Cosmito</td>\n<td align=\"right\">MULTIPOLYGON (((-73.01919 -36.79901, -73.02318...</td>\n<td>#a6611a</td>\n</tr>\n<tr>\n<td align=\"right\">3</td>\n<td align=\"right\">Formación Andalién</td>\n<td align=\"right\">MULTIPOLYGON (((-73.05011 -36.78331, -73.04993...</td>\n<td>#ffff00</td>\n</tr>\n<tr>\n<td align=\"right\">4</td>\n<td align=\"right\">Plutón Hualpén</td>\n<td align=\"right\">MULTIPOLYGON (((-73.19121 -36.74677, -73.19089...</td>\n<td>#d52dff</td>\n</tr>\n<tr>\n<td align=\"right\">5</td>\n<td align=\"right\">Formación Quiriquina</td>\n<td align=\"right\">MULTIPOLYGON (((-72.99422 -36.73964, -72.99405...</td>\n<td>#5cff51</td>\n</tr>\n<tr>\n<td align=\"right\">6</td>\n<td align=\"right\">Serie Occidental</td>\n<td align=\"right\">MULTIPOLYGON (((-73.16328 -36.80132, -73.17814...</td>\n<td>#5d5d5d</td>\n</tr>\n</tbody>\n</table>\n<h2>Creación del mapa interactivo</h2>\n<p>El siguiente paso corresponde a crear un objeto de mapa con <code>folium.Map()</code>. Esta clase nos permite durante la creación del objeto ajustar parámetros que determinarán las caracteristicas iniciales de nuestro mapa, en este caso <code>location</code> y <code>zoom_start</code> determinan el punto central del mapa y el nivel de acercamiento, respectivamente.</p>\n<deckgo-highlight-code language=\"python\" terminal=\"carbon\" theme=\"monokai\" line-numbers=\"true\"  >\n          <code slot=\"code\"># Creacion de objeto mapa\r\nmapa_geologico = folium.Map(location=[-36.7, -73.1], zoom_start=11)</code>\n        </deckgo-highlight-code>\n<p>Posteriormente, se creará un objeto por separado para cada unidad, lo cual nos permitirá asignarle el nombre de la capa y el color del polígono individualmente, además de permitirnos activar y desactivar la capa respectiva en el mapa final. Para esto se crea un nuevo GeoDataFrame para cada unidad (<code>gdf_unidad</code>), lo cual se logra filtrando el GeoDataFrame original según el nombre de cada unidad en particular (obtenido en este caso iterando las claves de nuestro diccionario de colores).</p>\n<p>Cada unidad se transforma en un objeto interpretable por <code>folium</code> mediante  <code>folium.GeoJson()</code>, el cual acepta nuestra unidad en formato json, además de parámetros como el nombre, y una función de estilo, la que recibe una función que entregue un diccionario con los valores de estilo correspondientes, y donde se establece como color de relleno el valor de la columna de color definida anteriormente. Finalmente se agrega este objeto a nuestro objeto de mapa creado anteriormente (<code>mapa_geologico</code>), y se agrega también un control  de capas con <code>folium.LayerControl</code> que nos permitirá activar y desactivar cada unidad geológica por separado.</p>\n<deckgo-highlight-code language=\"python\" terminal=\"carbon\" theme=\"monokai\" line-numbers=\"true\"  >\n          <code slot=\"code\">for unidad in colores_unidades.keys():\r\n    gdf_unidad = geologia.loc[geologia[&quot;Nombre_Uni&quot;] == unidad]\r\n\r\n    folium.GeoJson(\r\n        gdf_unidad.to_json(),\r\n        name=unidad,\r\n        style_function=lambda json: {\r\n            &quot;fillColor&quot;: json[&quot;properties&quot;][&quot;color_unidad&quot;],\r\n            &quot;fillOpacity&quot;: 0.85,\r\n            &quot;color&quot;: &quot;grey&quot;,\r\n            &quot;weight&quot;: 0.5\r\n        },\r\n        tooltip=unidad\r\n    ).add_to(mapa_geologico)\r\n\r\nfolium.LayerControl(collapsed=False).add_to(mapa_geologico)\r\n\r\nmapa_geologico</code>\n        </deckgo-highlight-code>\n<p>Finalmente podemos guardar nuestro mapa en formato html para poder compartirlo o integrarlo en alguna página web.</p>\n<deckgo-highlight-code language=\"python\" terminal=\"carbon\" theme=\"monokai\" line-numbers=\"true\"  >\n          <code slot=\"code\">mapa_geologico.save(&quot;mapa_geologico.html&quot;)</code>\n        </deckgo-highlight-code>","frontmatter":{"stack":"Python","tags":"Python, Mapas, geopandas, folium","title":"Mapa geológico interactivo con Folium"}}},"pageContext":{"slug":"mapa-geologico-interactivo-folium"}},"staticQueryHashes":[]}